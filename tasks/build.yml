version: '3'

tasks:
  logos:
    desc: Generate logos from SVG for all platforms
    dir: "packages/tailwind"
    cmds:
      - |
        if [ ! -d "node_modules" ]; then
          echo "Installing Tailwind dependencies..."
          npm install
        fi
      - npm run generate:logos

  tailwind:
    desc: Build Tailwind CSS
    dir: "packages/tailwind"
    deps: [logos]
    cmds:
      - |
        if [ ! -d "node_modules" ]; then
          echo "Installing Tailwind dependencies..."
          npm install
        fi
      - npm run build

  web:
    desc: Build the web app for production
    dir: "{{.WEB_DIR}}"
    deps: [tailwind]
    cmds:
      - dx bundle --release --web

  api:
    desc: Build the API Worker
    dir: "{{.API_DIR}}/main"
    cmds:
      - worker-build

  api:prod:
    desc: Build the API Worker for production (same as GitHub action)
    dir: "{{.API_DIR}}/main"
    deps: [run:api:setup]
    cmds:
      - |
        echo "Ensuring wasm32-unknown-unknown target is installed..."
        rustup target add wasm32-unknown-unknown || true
      - worker-build

  clean:
    desc: Clean build artifacts
    cmds:
      - cargo clean

