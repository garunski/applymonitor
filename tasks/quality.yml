version: '3'

tasks:
  format:
    desc: Format all Rust code in the workspace
    cmds:
      - cargo fmt --all

  default:
    desc: Run all cargo quality checks (format, clippy, test, check) treating warnings as errors
    deps: [format]
    cmds:
      - |
        echo "ğŸ” Checking code formatting..."
        cargo fmt --all -- --check
      - |
        echo "ğŸ” Running clippy (treating warnings as errors)..."
        cargo clippy --package ui --package web -- -D warnings
      - |
        echo "ğŸ” Running tests..."
        cargo test --package ui --package web
      - |
        echo "ğŸ” Checking compilation (native target)..."
        cargo check --package ui --package web
      - |
        echo "ğŸ” Checking compilation (WASM target for web packages and API)..."
        cargo check --package ui --target wasm32-unknown-unknown
        cargo check --package web --target wasm32-unknown-unknown
        cargo check --package api-main --target wasm32-unknown-unknown
        cargo check --package api-gmail-scanner --target wasm32-unknown-unknown
        cargo check --package api-ai-processor --target wasm32-unknown-unknown
      - |
        echo "ğŸ” Running clippy for WASM target (treating warnings as errors)..."
        cargo clippy --package ui --target wasm32-unknown-unknown -- -D warnings
        cargo clippy --package web --target wasm32-unknown-unknown -- -D warnings
        cargo clippy --package api-main --target wasm32-unknown-unknown -- -D warnings
        cargo clippy --package api-gmail-scanner --target wasm32-unknown-unknown -- -D warnings
        cargo clippy --package api-ai-processor --target wasm32-unknown-unknown -- -D warnings
      - echo "âœ… All quality checks passed!"
